{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Home","text":""},{"location":"#bienvenido-a-ansible101-lab","title":"Bienvenido a Ansible101 Lab","text":""},{"location":"#requisitos","title":"Requisitos","text":"<p>Info</p> <p>Actualmente SOLO est\u00e1 sorpotado en Linux y en Windows con WSL</p> <p>Es necesario instalar Podman: https://podman.io/docs/installation#installing-on-linux</p>"},{"location":"#habilitar-el-socket-api-de-podman","title":"Habilitar el socket API de Podman","text":"<p>Verificar que el socket existe: <pre><code>ls -l /run/user/$UID/podman/podman.sock\n</code></pre></p> <p>Si aparece, la API est\u00e1 habilitada.</p> <p>Si no existe, ejecuta: <pre><code>systemctl --user enable --now podman.socket\n</code></pre></p> <p>Esto crea el socket: <pre><code>/run/user/$UID/podman/podman.sock\n</code></pre></p> <p>Comprueba que est\u00e1 activo: <pre><code>systemctl --user status podman.socket\n</code></pre></p> <p>Debes ver algo como: <pre><code>Active: active (listening)\n</code></pre></p> <p>Verificar que el socket existe: <pre><code>ls -l /run/user/$UID/podman/podman.sock\n</code></pre></p> <p>Si aparece, la API est\u00e1 habilitada.</p>"},{"location":"#instalacion","title":"Instalaci\u00f3n","text":"<ol> <li>Descargar la \u00faltima versi\u00f3n del binario aqu\u00ed</li> <li>Crear directorio de trabajo y mover el binario dentro <pre><code>mkdir -p &lt;ruta_directorio&gt;\nmv &lt;ruta_binario&gt; &lt;ruta_directorio&gt;\n</code></pre></li> <li>Agregar al <code>PATH</code> el directorio donde hemos movido el binario <code>lab</code> <pre><code>export PATH=$(pwd):$PATH\n</code></pre></li> </ol> <p>Nota</p> <p>Ya que los comando crean ficheros en la ruta donde se lanzan, se recomienda crear una carpeta nueva donde trabajar</p>"},{"location":"#comandos","title":"Comandos","text":"<ul> <li><code>lab [OPTIONS] COMMAND [ARGS]...</code> - Comando para interactuar con el laboratorio <pre><code>Options\n--install-completion     Install completion for the current shell\n--show-completion        Show completion for the current shell, to copy it or customize the installation\n--help               -h  Show this message and exit\n\nCommand\ninit        Inicia el laboratorio y sus dependencias\nstart       Inicia las dependencias del ejercicio correspondiente\ngrade       Evalua el ejercicio correspondiente\nfinish      Libera las dependencias del ejercicio correspondiente\n</code></pre></li> </ul>"},{"location":"#inicializar-el-laboratorio","title":"Inicializar el laboratorio","text":"<p>Lanzar el comando: <pre><code>lab init\n</code></pre></p> <p>esto comenzar\u00e1 realizar varias comprobaciones, buildear la imagen necesaria, generar\u00e1 un fichero de configuraci\u00f3n <code>.lab_config.json</code></p> <p>Nota</p> <p>La inicializaci\u00f3n del labarotario puede tardar varios MINUTOS</p>"},{"location":"admonitions_list/","title":"Listado de admonitions","text":"<p>Note</p> <p>Texto de prueba <pre><code>!!! note\n</code></pre></p> <p>Info</p> <p>Texto de prueba <pre><code>!!! info\n</code></pre></p> <p>Tip</p> <p>Texto de prueba <pre><code>!!! tip\n</code></pre></p> <p>Success</p> <p>Texto de prueba <pre><code>!!! success\n</code></pre></p> <p>Question</p> <p>Texto de prueba <pre><code>!!! question\n</code></pre></p> <p>Warning</p> <p>Texto de prueba <pre><code>!!! warning\n</code></pre></p> <p>Danger</p> <p>Texto de prueba <pre><code>!!! danger\n</code></pre></p> <p>Example</p> <p>Texto de prueba <pre><code>!!! example\n</code></pre></p> <p>Quote</p> <p>Texto de prueba <pre><code>!!! quote\n</code></pre></p> <p>Abstract</p> <p>Texto de prueba <pre><code>!!! abstract\n</code></pre></p> <p>Bug</p> <p>Texto de prueba <pre><code>!!! bug\n</code></pre></p> <p>Failure</p> <p>Texto de prueba <pre><code>!!! failure\n</code></pre></p>"},{"location":"basics/","title":"Fundamentos","text":""},{"location":"basics/#2-fundamentos-de-ansible","title":"\ud83e\udde9 2: Fundamentos de Ansible","text":""},{"location":"basics/#objetivos","title":"\ud83c\udfaf Objetivos","text":"<p>Al finalizar este m\u00f3dulo, ser\u00e1s capaz de:</p> <ol> <li>Ejecutar comandos ad-hoc para realizar acciones r\u00e1pidas</li> <li>Comprender la estructura y sintaxis de un playbook en YAML</li> <li>Crear y ejecutar tareas simples y compuestas dentro de un playbook</li> <li>Utilizar m\u00f3dulos comunes de Ansible</li> <li>Diferenciar entre la ejecuci\u00f3n puntual (ad-hoc) y la automatizaci\u00f3n persistente (playbooks)</li> </ol>"},{"location":"basics/#teoria","title":"\ud83e\udde0 Teor\u00eda","text":""},{"location":"basics/#comandos-ad-hoc","title":"Comandos Ad-hoc","text":"<p>Los comandos ad-hoc son una forma r\u00e1pida de ejecutar tareas simples en uno o varios hosts sin escribir un playbook</p> <p>Sintaxis general:</p> <pre><code>ansible -i &lt;fichero_inventario&gt; &lt;grupo_o_host&gt; -m &lt;m\u00f3dulo&gt; -a \"&lt;argumentos&gt;\"\n</code></pre> <p>Info</p> <p>Para evitar tener que usar el <code>-i &lt;inventory_file&gt;</code> todo el rato es recomendable definir la linea <code>inventory = ./inventory</code> en el fichero ansible.cfg.     Al usar tanto <code>ansible</code> como <code>ansible-playbook</code> en el directorio donde tengamos el fichero, no har\u00e1 falta usar el <code>-i</code></p> <p>Ejemplos:</p> Objetivo Comando Comprobar conectividad <code>ansible -i inventory all -m ping</code> Ver versi\u00f3n del kernel <code>ansible -i inventory all -m command -a \"uname -r\"</code> Crear un directorio <code>ansible -i inventory all -m file -a \"path=/tmp/demo state=directory\"</code> Instalar un paquete <code>ansible -i inventory webservers -m apt -a \"name=nginx state=present become=true\"</code> <p>Note</p> <p>Los comandos ad-hoc sirven para pruebas o tareas simples, pero no son repetibles ni versionables.      Para automatizaci\u00f3n completa, siempre se recomienda un playbook</p>"},{"location":"basics/#sintaxis-de-un-playbook","title":"Sintaxis de un Playbook","text":"<p>Un playbook es un archivo YAML que describe uno o m\u00e1s plays. Cada play define:</p> <ol> <li>A qu\u00e9 hosts se aplicar\u00e1 (<code>hosts:</code>)</li> <li>Qu\u00e9 tareas se ejecutar\u00e1n (<code>tasks:</code>)</li> <li>Con qu\u00e9 permisos (<code>become:</code>)</li> <li>Opcionalmente, roles, variables, o handlers</li> </ol> <p>Ejemplo:</p> <pre><code>---\n- name: Instalar y habilitar Nginx\n  hosts: webservers\n  become: true\n  tasks:\n    - name: Instalar Nginx\n      ansible.builtin.package:\n        name: nginx\n        state: present\n\n    - name: Iniciar y habilitar el servicio\n      ansible.builtin.service:\n        name: nginx\n        state: started\n        enabled: true\n</code></pre> <p>Tip</p> <p>YAML es sensible a la indentaci\u00f3n y Ansible, por defecto, requiere el uso de espacios (no tabulaciones).</p> <p>Recomendaci\u00f3n: Configura tu editor de c\u00f3digo para que <code>TAB</code> inserte dos espacios en lugar de un car\u00e1cter de tabulaci\u00f3n. Esto previene la mayor\u00eda de los errores de sintaxis.</p> <p>Cada playbook se compone de bloques l\u00f3gicos:</p> Elemento Descripci\u00f3n Ejemplo <code>hosts:</code> Define sobre qu\u00e9 grupo de servidores se ejecutar\u00e1 el play <code>hosts: webservers</code> <code>become:</code> Permite ejecutar tareas como superusuario (sudo) <code>become: true</code> <code>tasks:</code> Lista de acciones a ejecutar Ver ejemplo arriba <code>vars:</code> Define variables internas del playbook <code>vars: { pkg_name: nginx }</code> <code>handlers:</code> Tareas que se ejecutan solo cuando se notifican <code>notify: Reiniciar Nginx</code>"},{"location":"basics/#modulos-comunes","title":"M\u00f3dulos Comunes","text":"<p>Los m\u00f3dulos m\u00e1s usados en comandos ad-hoc ser\u00edan:</p> M\u00f3dulo Descripci\u00f3n Ejemplo <code>ping</code> Verificar conexi\u00f3n y autenticaci\u00f3n <code>ansible all -m ping</code> <code>command</code> Ejecutar un comando sin shell <code>ansible all -m command -a \"uptime\"</code> <code>shell</code> Ejecutar comandos dentro de una shell <code>ansible all -m shell -a \"cat /etc/os-release\"</code> <code>file</code> Gestionar archivos y permisos <code>ansible all -m file -a \"path=/tmp/demo state=directory\"</code> <code>copy</code> Copiar archivos locales a hosts remotos <code>ansible all -m copy -a \"src=./test.txt dest=/tmp/test.txt\"</code> <code>service</code> Controlar servicios del sistema <code>ansible all -m service -a \"name=nginx state=restarted\"</code> <p>Warning</p> <p>Usa el m\u00f3dulo <code>shell</code> solo cuando sea necesario</p> <p>Intenta usar m\u00f3dulos espec\u00edficos (<code>user</code>, <code>package</code>, <code>service</code>, <code>copy</code>, etc.) para asegurar la idempotencia (obtener el mismo resultado aunque se aplique m\u00faltiples veces)</p>"},{"location":"basics/#ejemplo-practico","title":"\u2699\ufe0f Ejemplo Pr\u00e1ctico","text":"<p>Vamos a practicar el flujo completo:</p> <ul> <li>Ejecutar un comando ad-hoc</li> <li>Crear un playbook con tareas equivalentes</li> </ul>"},{"location":"basics/#1-comando-ad-hoc","title":"1. Comando ad-hoc","text":"<p>Creamos un directorio <code>/tmp/webdemo</code> en <code>localhost</code>:</p> <pre><code>ansible localhost -m file -a \"path=/tmp/webdemo state=directory\"\n</code></pre> <p>Salida esperada:</p> <pre><code>localhost | CHANGED =&gt; {\n    \"path\": \"/tmp/webdemo\",\n    \"state\": \"directory\",\n    \"changed\": true\n}\n</code></pre>"},{"location":"basics/#2-crear-el-mismo-resultado-con-un-playbook","title":"2. Crear el mismo resultado con un Playbook","text":"<p>Archivo <code>webdemo.yml</code>:</p> <pre><code>---\n- name: Crear estructura de demo web\n  hosts: localhost\n  connection: local\n  tasks:\n    - name: Crear directorio de trabajo\n      ansible.builtin.file:\n        path: /tmp/webdemo\n        state: directory\n\n    - name: Crear un index.html b\u00e1sico\n      ansible.builtin.copy:\n        dest: /tmp/webdemo/index.html\n        content: \"&lt;h1&gt;Servidor gestionado con Ansible&lt;/h1&gt;\"\n\n    - name: Mostrar mensaje final\n      ansible.builtin.debug:\n        msg: \"La estructura web se ha creado correctamente en /tmp/webdemo\"\n</code></pre> <p>Ejecutar:</p> <pre><code>ansible-playbook webdemo.yml\n</code></pre> <p>Salida esperada:</p> <pre><code>PLAY [Crear estructura de demo web] *******************************************\n\nTASK [Crear directorio de trabajo] ********************************************\nchanged: [localhost]\n\nTASK [Crear un index.html b\u00e1sico] *********************************************\nchanged: [localhost]\n\nTASK [Mostrar mensaje final] **************************************************\nok: [localhost] =&gt; {\n    \"msg\": \"La estructura web se ha creado correctamente en /tmp/webdemo\"\n}\n\nPLAY RECAP ********************************************************************\nlocalhost : ok=3  changed=2  failed=0\n</code></pre>"},{"location":"basics/#errores-comunes-y-buenas-practicas","title":"\ud83d\udea8 Errores Comunes y Buenas Pr\u00e1cticas","text":""},{"location":"basics/#errores-comunes","title":"Errores Comunes","text":"<ol> <li> <p>Indentaci\u00f3n incorrecta (YAML)</p> <pre><code>Syntax Error while loading YAML.\n    mapping values are not allowed in this context\n</code></pre> </li> <li> <p>Error de conexi\u00f3n</p> <pre><code>UNREACHABLE! =&gt; Failed to connect via ssh\n</code></pre> <p>\u2192 Verifica el <code>inventory</code> y los permisos de acceso.</p> </li> <li> <p>Uso indebido de <code>shell</code>    \u2192 Si puedes lograrlo con un m\u00f3dulo, no uses <code>shell</code> o <code>command</code>.</p> </li> </ol>"},{"location":"basics/#buenas-practicas","title":"Buenas Pr\u00e1cticas","text":"<p>Tip</p> <ul> <li>Los comandos ad-hoc son para acciones r\u00e1pidas, no para automatizaciones permanentes.</li> <li>Los playbooks deben ser claros y repetibles, y versionados en Git.</li> <li>Usa nombres descriptivos en las tareas (<code>name:</code>).</li> <li>Mant\u00e9n un formato uniforme en YAML y agrupa tareas relacionadas.</li> <li>A\u00f1ade comentarios y usa variables para evitar valores \u201chardcodeados\u201d.</li> </ul>"},{"location":"basics/#ejercicio-propuesto","title":"\ud83d\udcda Ejercicio Propuesto","text":"<p>Crea un playbook llamado <code>system_info.yml</code> que:</p> <ol> <li>Se ejecute sobre <code>localhost</code> (conexi\u00f3n local).</li> <li>Obtenga y muestre la siguiente informaci\u00f3n:<ul> <li>Nombre del sistema operativo (<code>ansible_distribution</code>)</li> <li>Versi\u00f3n (<code>ansible_distribution_version</code>)</li> <li>Direcci\u00f3n IP principal (<code>ansible_default_ipv4.address</code>)</li> </ul> </li> <li>Guarde la informaci\u00f3n en un archivo <code>/tmp/system_info.txt</code> en formato de texto plano.</li> <li>Muestre un mensaje final con <code>debug:</code> confirmando la creaci\u00f3n del archivo.</li> </ol> <p>Tip</p> <ul> <li>Usa el m\u00f3dulo <code>copy</code> con la opci\u00f3n <code>content:</code> para escribir texto directamente en un fichero</li> <li>Puedes obtener informaci\u00f3n de un sistema usando el m\u00f3dulo <code>setup</code> o a\u00f1adiendo <code>gather_facts: true</code> en el play<ul> <li>Esa informaci\u00f3n queda definida en variables especiales que empiezan por <code>ansible_</code> \u279c link docs</li> </ul> </li> </ul> <p>Note</p> <p>Este ejercicio te ense\u00f1a a combinar m\u00f3dulos, facts y variables, los tres pilares del trabajo diario con Ansible.</p>"},{"location":"config_databases/","title":"Configurar Databases","text":""},{"location":"config_databases/#7-gestion-de-bases-de-datos-con-postgresql","title":"\ud83e\udde9 7: Gesti\u00f3n de Bases de Datos con PostgreSQL","text":""},{"location":"config_databases/#objetivo-general","title":"\ud83c\udfaf Objetivo general","text":"<p>Al finalizar este m\u00f3dulo, ser\u00e1s capaz de:</p> <ol> <li>Instalar y configurar PostgreSQL 16 mediante un rol dedicado</li> <li>Inicializar el cluster (bases de datos, usuarios y permisos) usando Ansible</li> <li>Ejecutar consultas SQL desde un playbook</li> </ol>"},{"location":"config_databases/#comandos-del-ejercicio","title":"\ud83d\udede Comandos del ejercicio","text":"<p>Para iniciar el ejercicio, ejecuta: <pre><code>lab start databases\n</code></pre></p> <p>Para evaluar el ejercicio, ejecuta: <pre><code>lab grade databases\n</code></pre></p>"},{"location":"config_databases/#instalacion-y-configuracion-de-postgresql-usando-roles","title":"\ud83d\udcd8 Instalaci\u00f3n y Configuraci\u00f3n de PostgreSQL usando roles","text":""},{"location":"config_databases/#estructura-del-rol","title":"\ud83c\udfd7\ufe0f Estructura del rol","text":"<pre><code>roles/\n  postgresql/\n    defaults/\n      main.yml\n    tasks/\n      main.yml\n      install.yml\n      configure.yml\n    templates/\n      pg_hba.conf.j2\n    handlers/\n      main.yml\n</code></pre> <p>defaults/main.yml <pre><code>postgresql_version: 16\npostgresql_port: 5432\npostgresql_listen_address: \"0.0.0.0\"\npostgresql_db_name: appdb\npostgresql_db_user: appuser\npostgresql_db_password: ansible_123\n</code></pre></p> <p>templates/pg_hba.conf.j2 <pre><code># cualquier usuario del sistema puede conectarse a cualquier base de datos sin contrase\u00f1a usando el socket Unix\nlocal   all             all                                     trust\n# cualquier host puede conectarse via TCP/IP, pero debe usar contrase\u00f1a\nhost    all             all             0.0.0.0/0               md5\n</code></pre></p> <p>tasks/main.yml <pre><code>- name: Instalar PostgreSQL\n  ansible.builtin.include_tasks: install.yml\n\n- name: Configurar PostgreSQL\n  ansible.builtin.include_tasks: configure.yml\n</code></pre></p> <p>tasks/install.yml <pre><code>---\n- name: Instalar repositorio oficial de PostgreSQL\n  become: true\n  ansible.builtin.dnf:\n    name: \"https://download.postgresql.org/pub/repos/yum/reporpms/EL-{{ ansible_distribution_major_version }}-{{ ansible_architecture }}/pgdg-redhat-repo-latest.noarch.rpm\"\n    state: present\n    disable_gpg_check: true\n\n- name: Deshabilitar PostgreSQL del AppStream\n  become: true\n  ansible.builtin.shell: dnf -qy module disable postgresql\n  ignore_errors: true\n\n- name: Instalar PostgreSQL Server\n  become: true\n  ansible.builtin.package:\n    name:\n      - \"postgresql{{ postgresql_version }}\"\n      - \"postgresql{{ postgresql_version }}-server\"\n    state: present\n</code></pre></p> <p>tasks/configure.yml <pre><code>- name: Inicializar el repositorio\n  become: true\n  ansible.builtin.shell: /usr/pgsql-{{ postgresql_version }}/bin/postgresql-{{ postgresql_version }}-setup initdb\n  args:\n    creates: \"/var/lib/pgsql/{{ postgresql_version }}/data/PG_VERSION\"\n\n- name: Configurar el servicio\n  become: true\n  ansible.builtin.service:\n    name: postgresql-{{ postgresql_version }}\n    enabled: true\n    state: started\n\n- name: Copiar pg_hba.conf\n  become: true\n  become_user: postgres\n  ansible.builtin.template:\n    src: pg_hba.conf.j2\n    dest: \"/var/lib/pgsql/{{ postgresql_version }}/data/pg_hba.conf\"\n  notify: Reiniciar PostgreSQL\n\n- name: Activamos el listener\n  become: true\n  become_user: postgres\n  ansible.builtin.replace:\n    path: /var/lib/pgsql/{{ postgresql_version }}/data/postgresql.conf\n    regexp: \"^#listen_addresses = 'localhost'\"\n    replace: \"listen_addresses = '{{ postgresql_listen_address }}'\"\n  notify: Reiniciar PostgreSQL\n\n- name: Activamos el puerto\n  become: true\n  become_user: postgres\n  ansible.builtin.replace:\n    path: /var/lib/pgsql/{{ postgresql_version }}/data/postgresql.conf\n    regexp: '^\\s*#?\\s*port\\s*=.*$'\n    replace: 'port = {{ postgresql_port }}'\n  notify: Reiniciar PostgreSQL\n\n- ansible.builtin.meta: flush_handlers\n\n- name: Esperar a que {{ postgresql_port }} este activo\n  become: true\n  ansible.builtin.wait_for:\n    host: localhost\n    port: \"{{ postgresql_port }}\"\n    delay: 5\n    timeout: 60\n    state: started\n\n- name: Testar conexion a la instancia\n  become: true\n  become_user: postgres\n  become_flags: -i\n  ansible.builtin.shell:\n    cmd: psql -p {{ postgresql_port }} -t -c \"select version();\"\n  register: version_output\n\n- name: Seteamos password al usuario 'postgres'\n  become: true\n  become_user: postgres\n  become_flags: -i\n  ansible.builtin.shell:\n    cmd: psql -p {{ postgresql_port }} -c \"ALTER USER postgres WITH PASSWORD '{{ postgresql_db_password }}';\"\n\n- name: Mostramos la version instalada\n  ansible.builtin.debug:\n    msg: \n      - \"Instalada la version:\"\n      - \"{{ version_output.stdout | trim }}\"\n</code></pre></p> <p>handlers/main.yml <pre><code>- name: Reiniciar PostgreSQL\n  become: true\n  ansible.builtin.service:\n    name: \"postgresql-{{ postgresql_version }}\"\n    state: restarted\n</code></pre></p>"},{"location":"config_databases/#playbook-principal","title":"\ud83d\udcd8 Playbook principal","text":"<p>databases.yml <pre><code>---\n- hosts: dbservers\n  gather_facts: true\n  roles:\n    - role: postgresql\n</code></pre></p> <p>Ejecuci\u00f3n del playbook</p> <p>Tras ejecutar sin errores el playbook  <pre><code>ansible-playbook databases.yml\n</code></pre> deberias poder logar en la m\u00e1quina con  <pre><code>ssh db1\n</code></pre> cambiar al usuario <code>postgres</code> con  <pre><code>sudo su - postgres\n</code></pre> y logar en la instancia con el comando  <pre><code>psql\n</code></pre></p>"},{"location":"config_databases/#ejercicio-1-cambiar-el-puerto-de-postgresql","title":"\ud83d\udcda Ejercicio 1 \u2014 Cambiar el puerto de PostgreSQL","text":"<p>Modificar: <pre><code>postgresql_port: 5433\n</code></pre></p> <p>Y probar conexi\u00f3n, usando como password <code>ansible_123</code>: <pre><code>psql -h localhost -p 5433\n</code></pre></p> Solucion <p>En postgresql/defaults/main.yml modificar <code>postgresql_port: 5433</code> PostgreSQL se reiniciar\u00e1 automaticamente por handler.</p>"},{"location":"config_databases/#ejercicio-2-anadir-una-tabla","title":"\ud83d\udcda Ejercicio 2 \u2014 A\u00f1adir una tabla","text":"<p>Danger</p> <p>Para el laboratorio vamos a usar la base de datos postgres, pero NO es una buena pr\u00e1ctica</p> <p>Crear el fichero postgresql/tasks/database.yml: <pre><code>- name: Crear tabla empleados\n  become: true\n  become_user: postgres\n  become_flags: -i\n  ansible.builtin.shell: |\n    psql -p {{ postgresql_port }} -d \"postgres\" -c \"\n      CREATE TABLE IF NOT EXISTS empleados (\n        id SERIAL PRIMARY KEY,\n        username TEXT NOT NULL,\n        created_at TIMESTAMP DEFAULT NOW()\n      );\n    \"\n</code></pre></p> <p>Note</p> <p>RECUERDA a\u00f1adir el nuevo fichero database.yml en postgresql/tasks/main.yml</p> Solucion <pre><code>- name: Creacion de tablas y usuarios\n  ansible.builtin.include_tasks: database.yml\n</code></pre>"},{"location":"config_databases/#ejercicio-3-insertar-datos-desde-ansible","title":"\ud83d\udcda Ejercicio 3 \u2014 Insertar datos desde Ansible","text":"<p>A\u00f1adir una tarea en postgresql/tasks/database.yml: <pre><code>- name: Insertar usuario admin\n  become: true\n  become_user: postgres\n  become_flags: -i\n  ansible.builtin.shell: |\n    psql -p {{ postgresql_port }} -d \"postgres\" -c \"INSERT INTO empleados (username) VALUES ('admin');\"\n</code></pre></p>"},{"location":"config_databases/#ejercicio-4-crear-varios-usuarios-dinamicamente","title":"\ud83d\udcda Ejercicio 4 \u2014 Crear varios usuarios din\u00e1micamente","text":"<p>A\u00f1adir lista en defaults/main.yml: <pre><code>postgresql_initial_users:\n  - alice\n  - bob\n  - charlie\n</code></pre></p> <p>A\u00f1adir una tarea en postgresql/tasks/database.yml: <pre><code>- name: Insertar usuarios iniciales\n  become: true\n  become_user: postgres\n  become_flags: -i\n  ansible.builtin.shell:\n    cmd: psql -p {{ postgresql_port }} -d \"postgres\" -c \"INSERT INTO empleados (username) VALUES ('{{ nombre_empleado }}');\"\n  loop: \"{{ postgresql_initial_users }}\"\n  loop_control:\n    loop_var: nombre_empleado\n</code></pre></p> <p>Validar</p> <p>Tras ejecutar sin errores el playbook  <pre><code>ansible-playbook databases.yml\n</code></pre> deberias poder logar en la m\u00e1quina con  <pre><code>ssh db1\n</code></pre> cambiar al usuario <code>postgres</code> con  <pre><code>sudo su - postgres\n</code></pre> y logar en la instancia con el comando  <pre><code>export PGPORT=5433\npsql\n</code></pre> <pre><code>select * from empleados;\n</code></pre> y ver algo como: <pre><code>postgres=# select * from empleados;\nid | username |         created_at\n----+----------+----------------------------\n  1 | admin    | 2025-11-27 20:55:37.380092\n  2 | alice    | 2025-11-27 20:55:37.802237\n  3 | bob      | 2025-11-27 20:55:38.21942\n  4 | charlie  | 2025-11-27 20:55:38.629579\n</code></pre></p>"},{"location":"config_webservers/","title":"Configurar WebServers","text":""},{"location":"config_webservers/#6-configuracion-de-servidores-web","title":"\ud83e\udde9 6: Configuraci\u00f3n de Servidores Web","text":""},{"location":"config_webservers/#objetivo-general","title":"\ud83c\udfaf Objetivo general","text":"<p>Al finalizar este m\u00f3dulo, ser\u00e1s capaz de:</p> <ol> <li>Instalar y configurar Apache usando un rol completo</li> <li>Instalar y configurar Nginx como reverse proxy hacia Apache</li> <li>Usar templates, handlers, variables y roles</li> <li>Ejecutar todo en un playbook que orquesta ambos roles</li> </ol>"},{"location":"config_webservers/#comandos-del-ejercicio","title":"\ud83d\udede Comandos del ejercicio","text":"<p>Para iniciar el ejercicio, ejecuta: <pre><code>lab start webservers\n</code></pre></p> <p>Para evaluar el ejercicio, ejecuta: <pre><code>lab grade webservers\n</code></pre></p>"},{"location":"config_webservers/#instalacion-y-configuracion-de-apache-usando-roles","title":"\ud83d\udcd8 Instalaci\u00f3n y configuraci\u00f3n de Apache usando roles","text":""},{"location":"config_webservers/#estructura-del-rol","title":"\ud83c\udfd7\ufe0f Estructura del rol","text":"<pre><code>roles/\n  apache/\n    tasks/\n      main.yml\n      install.yml\n    templates/\n      httpd.conf.j2\n    handlers/\n      main.yml\n    defaults/\n      main.yml\n</code></pre> <p>defaults/main.yml <pre><code>apache_port: 8080\napache_docroot: /var/www/html\n</code></pre></p> <p>templates/httpd.conf.j2 <pre><code>Listen {{ apache_port }}\n\n&lt;VirtualHost *:{{ apache_port }}&gt;\n  DocumentRoot \"{{ apache_docroot }}\"\n  ErrorLog /var/log/httpd/error.log\n  CustomLog /var/log/httpd/access.log combined\n&lt;/VirtualHost&gt;\n</code></pre></p> <p>tasks/main.yml <pre><code>- name: Cargamos modulo de instalacion\n  ansible.builtin.include_tasks: install.yml\n</code></pre></p> <p>tasks/install.yml <pre><code>- name: Instalar Apache\n  become: true\n  ansible.builtin.package:\n    name: httpd\n    state: present\n\n- name: Asegurar que Apache esta habilitado y activo\n  become: true\n  ansible.builtin.service:\n    name: httpd\n    enabled: yes\n    state: started\n\n- name: Desactivar el listener por defecto en Apache\n  become: true\n  ansible.builtin.replace:\n    path: /etc/httpd/conf/httpd.conf\n    regexp: '^Listen 80'\n    replace: '# Listen 80'\n\n- name: Copiar configuracion de Apache\n  become: true\n  ansible.builtin.template:\n    src: httpd.conf.j2\n    dest: /etc/httpd/conf.d/main.conf\n  notify: \"Reiniciar Apache\"\n\n# Ejecuta todos los handlers pendientes, en vez de\n# esperar hasta que se terminen las tasks en el host\n- ansible.builtin.meta: flush_handlers\n</code></pre></p> <p>handlers/main.yml <pre><code>- name: Reiniciar Apache\n  become: true\n  ansible.builtin.service:\n    name: httpd\n    state: restarted\n</code></pre></p>"},{"location":"config_webservers/#instalacion-y-configuracion-de-nginx-reverse-proxy","title":"\ud83d\udcd8 Instalaci\u00f3n y configuraci\u00f3n de Nginx reverse proxy","text":""},{"location":"config_webservers/#estructura-del-rol_1","title":"\ud83c\udfd7\ufe0f Estructura del rol","text":"<pre><code>roles/\n  nginx/\n    tasks/\n      main.yml\n      install.yml\n    templates/\n      nginx.conf.j2\n      reverse-proxy.conf.j2\n    handlers/\n      main.yml\n    defaults/\n      main.yml\n</code></pre> <p>defaults/main.yml <pre><code>nginx_listen_port: 80\nnginx_upstream_host: \"127.0.0.1\"\nnginx_upstream_port: 8080\n</code></pre></p> <p>templates/reverse-proxy.conf.j2 <pre><code>server {\n    listen {{ nginx_listen_port }};\n    location / {\n      proxy_pass http://{{ nginx_upstream_host }}:{{ nginx_upstream_port }};\n      proxy_set_header Host $host;\n      proxy_set_header X-Real-IP $remote_addr;\n    }\n}\n</code></pre></p> <p>templates/nginx.conf.j2 <pre><code># For more information on configuration, see:\n#   * Official English Documentation: http://nginx.org/en/docs/\n#   * Official Russian Documentation: http://nginx.org/ru/docs/\n\nuser nginx;\nworker_processes auto;\nerror_log /var/log/nginx/error.log;\npid /run/nginx.pid;\n\n# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.\ninclude /usr/share/nginx/modules/*.conf;\n\nevents {\n    worker_connections 1024;\n}\n\nhttp {\n    log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '\n                      '$status $body_bytes_sent \"$http_referer\" '\n                      '\"$http_user_agent\" \"$http_x_forwarded_for\"';\n\n    access_log  /var/log/nginx/access.log  main;\n\n    sendfile            on;\n    tcp_nopush          on;\n    tcp_nodelay         on;\n    keepalive_timeout   65;\n    types_hash_max_size 2048;\n\n    include             /etc/nginx/mime.types;\n    default_type        application/octet-stream;\n\n    # Load modular configuration files from the /etc/nginx/conf.d directory.\n    # See http://nginx.org/en/docs/ngx_core_module.html#include\n    # for more information.\n    include /etc/nginx/conf.d/*.conf;\n\n# Settings for a HTTP server.\n#    server {\n#        #listen       80 default_server;\n#        #listen       [::]:80 default_server;\n#        server_name  _;\n#        root         /usr/share/nginx/html;\n#\n#        # Load configuration files for the default server block.\n#        include /etc/nginx/default.d/*.conf;\n#\n#        location / {\n#        }\n#\n#        error_page 404 /404.html;\n#            location = /40x.html {\n#        }\n#\n#        error_page 500 502 503 504 /50x.html;\n#            location = /50x.html {\n#        }\n#    }\n\n# Settings for a TLS enabled server.\n#\n#    server {\n#        listen       443 ssl http2 default_server;\n#        listen       [::]:443 ssl http2 default_server;\n#        server_name  _;\n#        root         /usr/share/nginx/html;\n#\n#        ssl_certificate \"/etc/pki/nginx/server.crt\";\n#        ssl_certificate_key \"/etc/pki/nginx/private/server.key\";\n#        ssl_session_cache shared:SSL:1m;\n#        ssl_session_timeout  10m;\n#        ssl_ciphers PROFILE=SYSTEM;\n#        ssl_prefer_server_ciphers on;\n#\n#        # Load configuration files for the default server block.\n#        include /etc/nginx/default.d/*.conf;\n#\n#        location / {\n#        }\n#\n#        error_page 404 /404.html;\n#            location = /40x.html {\n#        }\n#\n#        error_page 500 502 503 504 /50x.html;\n#            location = /50x.html {\n#        }\n#    }\n\n}\n</code></pre></p> <p>tasks/main.yml <pre><code>- name: Cargamos modulo de instalacion\n  ansible.builtin.include_tasks: install.yml\n</code></pre></p> <p>tasks/install.yml <pre><code>---\n- name: Instalar Nginx\n  become: true\n  ansible.builtin.package:\n    name: nginx\n    state: present\n\n- name: Copiar config principal\n  become: true\n  ansible.builtin.template:\n    src: nginx.conf.j2\n    dest: /etc/nginx/nginx.conf\n\n- name: Copiar config reverse proxy\n  become: true\n  ansible.builtin.template:\n    src: reverse-proxy.conf.j2\n    dest: /etc/nginx/conf.d/reverse-proxy.conf\n  notify: \"Recargar Nginx\"\n\n- name: Asegurar Nginx activo\n  become: true\n  ansible.builtin.service:\n    name: nginx\n    enabled: yes\n    state: started\n</code></pre></p> <p>handlers/main.yml</p> <pre><code>- name: Recargar Nginx\n  become: true\n  ansible.builtin.service:\n    name: nginx\n    state: reloaded\n</code></pre>"},{"location":"config_webservers/#playbook-principal","title":"\ud83d\udcd8 Playbook principal","text":"<p>Encargado de orquestar la ejecuci\u00f3n de los roles</p> <p>webservers.yml <pre><code>---\n- hosts: webservers\n  gather_facts: false\n  roles:\n    - role: apache\n    - role: nginx\n</code></pre></p> <p>Puntos clave:</p> <ul> <li>C\u00f3mo un rol depende de la salida del otro (<code>apache_port</code> \u2192 reverse proxy '<code>nginx_upstream_port</code>')</li> <li>C\u00f3mo pasar variables al rol correctamente (su scope es a nivel de play)</li> <li>C\u00f3mo manejar handlers independientes</li> <li>C\u00f3mo separar responsabilidades: Apache sirve contenido, Nginx lo expone</li> </ul> <p>Info</p> <p>Tras ejecutar sin errores el playbook <code>ansible-playbook webservers.yml</code> deberias ver la p\u00e1gina por defecto de Apache en <code>http://localhost:8080</code></p> <p></p>"},{"location":"config_webservers/#ejercicio-1-cambiar-el-puerto-de-apache","title":"\ud83d\udcda Ejercicio 1 \u2014 Cambiar el puerto de Apache","text":"<p>Cambiar el puerto por defecto de Apache: <pre><code>apache_port: 9090\n</code></pre> \u2192 Modificar el puerto de upstream en la configuraci\u00f3n de nginx tambi\u00e9n</p> Solucion <p>apache/defaults/main.yml : <code>apache_port: 8080</code> \u2192 <code>apache_port: 9090</code> ngnix/defaults/main.yml : <code>nginx_upstream_port: 8080</code> \u2192 <code>nginx_upstream_port: 9090</code></p>"},{"location":"config_webservers/#ejercicio-2-anadir-una-pagina-html-desde-template","title":"\ud83d\udcda Ejercicio 2 \u2014 A\u00f1adir una p\u00e1gina HTML desde template","text":"<p>A\u00f1adir en el rol Apache: <pre><code>templates/index.html.j2\ntasks/install.yml \u2192 A\u00f1adir tarea para desplegar el template\n</code></pre></p> <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"es\"&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n  &lt;title&gt;Lab Webservers&lt;/title&gt;\n  &lt;style&gt;\n    body {\n      font-family: Arial, sans-serif;\n      background-color: #f4f4f9;\n      color: #333;\n      text-align: center;\n      padding-top: 50px;\n    }\n    h1 {\n      color: #0066cc;\n    }\n    p {\n      font-size: 1.2em;\n    }\n    .box {\n      margin: 30px auto;\n      padding: 20px;\n      border: 2px solid #0066cc;\n      border-radius: 8px;\n      width: 60%;\n      background-color: #fff;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;div class=\"box\"&gt;\n    &lt;h1&gt;\u00a1Apache funcionando!&lt;/h1&gt;\n    &lt;p&gt;Has llegado a &lt;strong&gt;/var/www/html/index.html&lt;/strong&gt;&lt;/p&gt;\n    &lt;p&gt;Si ves esta pagina, tu configuracion de &lt;em&gt;VirtualHost&lt;/em&gt; est\u00e1 correcta.&lt;/p&gt;\n  &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> Solucion <p>A\u00f1adir las task al final de apache/tasks/install.yml <pre><code>- name: Desplegamos la pagina personalizada\n  ansible.builtin.template:\n    src: index.html.j2\n    dest: \"{{ apache_docroot }}/index.html\"\n</code></pre> Copiar el HTML en apache/templates/index.html.j2</p>"},{"location":"config_webservers/#ejercicio-3-anadir-health-check-en-nginx","title":"\ud83d\udcda Ejercicio 3 \u2014 A\u00f1adir health-check en Nginx","text":"<p>A\u00f1adir en el template de <code>reverse-proxy.conf.j2</code>: <pre><code>location /health {\n  return 200 \"OK\\n\";\n}\n</code></pre></p> Solucion <p>templates/reverse-proxy.conf.j2 debe quedar asi: <pre><code>server {\n  listen {{ nginx_listen_port }};\n  location / {\n    proxy_pass http://{{ nginx_upstream_host }}:{{ nginx_upstream_port }};\n    proxy_set_header Host $host;\n    proxy_set_header X-Real-IP $remote_addr;\n  }\n  location /health {\n    return 200 \"OK\\n\";\n  }\n}\n</code></pre></p>"},{"location":"final_project/","title":"Proyecto final","text":""},{"location":"final_project/#8-proyecto-final-automatizacion-completa-de-una-aplicacion-web","title":"\ud83e\udde9 8: Proyecto Final \u2014 Automatizaci\u00f3n Completa de una Aplicaci\u00f3n Web","text":""},{"location":"final_project/#objetivo-general","title":"\ud83c\udfaf Objetivo general","text":"<p>Al finalizar este m\u00f3dulo ser\u00e1s capaz de:</p> <ol> <li>Integrar Apache, Nginx y PostgreSQL en un \u00fanico proyecto automatizado.</li> <li>Desplegar una aplicaci\u00f3n web din\u00e1mica que lista empleados almacenados en PostgreSQL.</li> <li>Aplicar todo lo aprendido: roles, handlers, plantillas, variables y buenas pr\u00e1cticas.</li> <li>Construir un playbook maestro capaz de levantar una arquitectura completa de servidor web + reverse proxy + base de datos.</li> </ol>"},{"location":"final_project/#comandos-del-ejercicio","title":"\ud83d\udede Comandos del ejercicio","text":"<p>Para iniciar el ejercicio, ejecuta: <pre><code>lab start final\n</code></pre></p>"},{"location":"final_project/#arquitectura-del-proyecto","title":"\ud83c\udfd7\ufe0f Arquitectura del proyecto","text":"<pre><code>+----------------+      +------------+      +------------+\n\u2502 Aplicaci\u00f3n Web \u2502 ---&gt; \u2502   NGINX    \u2502 ---&gt; \u2502   APACHE   \u2502\n\u2502 (empleados)    \u2502      \u2502  Reverse   \u2502      \u2502  WebServer \u2502\n+----------------+      +------------+      +------------+\n                                                   \u2502\n                                                   \u25bc\n                                             +------------+\n                                             \u2502 PostgreSQL \u2502\n                                             +------------+\n</code></pre>"},{"location":"final_project/#estructura-del-proyecto","title":"\ud83d\udcd8 Estructura del proyecto","text":"<p>El proyecto final requiere 3 roles independientes:</p> <pre><code>roles/\n  postgresql/\n  apache/\n  nginx/\n</code></pre> <p>y un playbook maestro:</p> <pre><code>site.yml\n</code></pre>"},{"location":"final_project/#1-role-postgresql","title":"\ud83d\udcd8 1. Role: postgresql","text":"<p>Usaremos lo contruido en el tema 7: Gesti\u00f3n de Bases de Datos con PostgreSQL.</p> <p>Volver a configurar el puerto por defecto: 5432</p> <p>A\u00f1adimos consulta din\u00e1mica para obtener empleados desde Ansible en postgresql/tasks/database.yml y que el formato de salida sea un JSON:</p> Solucion <p>postgresql/defaults/main.yml : <code>postgresql_port: 5433</code> \u2192 <code>postgresql_port: 5432</code> </p> <p>A\u00f1adir en postgresql/tasks/database.yml: <pre><code>- name: Obtener listado de empleados\n  become: true\n  become_user: postgres\n  become_flags: -i\n  ansible.builtin.shell:\n    cmd: psql -p {{ postgresql_port }} -d \"postgres\" -t -A -F\",\" -c \"SELECT json_agg(empleados ORDER BY id) FROM empleados;\"\n  register: employees_list\n</code></pre></p>"},{"location":"final_project/#2-role-apache","title":"\ud83d\udcd8 2. Role: apache","text":"<p>Usaremos lo contruido en el tema 6: Configuraci\u00f3n de Servidores Web.</p> <p>Volver a configurar el puerto por defecto: 8080</p> <p>Tendremos que modificar el template de index.html para que muestre el listado de empleados de variable <code>query_output</code>. Para ello:</p> <ul> <li>Crear el fichero apache/tasks/deploy.yml</li> <li>Mover la tarea de desplegar el template dentro</li> <li>Crear una tarea previa para recuperar la lista de empleados desde el contexto de db1 usando <code>hostvars</code></li> <li>Convertir a objeto iterable desde JSON la variable que contiene la lista de empleados</li> <li>A\u00f1adir deploy.yml a main.yml dentro del rol de Apache</li> </ul> <p>Info</p> <p>Las variables que definimos en tiempo de ejecuci\u00f3n lo hacen en el contexto del host, para usarlas en otros contextos debemos usar su definici\u00f3n explicita:  <pre><code>hostvars['&lt;nombre_servidor&gt;']['&lt;nombre_variable&gt;']\n</code></pre></p> Solucion <p>apache/defaults/main.yml : <code>apache_port: 9090</code> \u2192 <code>apache_port: 8080</code></p> <p>apache/tasks/deploy.yml : <pre><code>- name: Recuperamos la lista de empleados desde el contexto de db1\n  ansible.builtin.set_fact:\n    employees_list: \"{{ hostvars['db1']['employees_list']['stdout'] | from_json }}\"\n\n- name: Desplegamos la pagina personalizada\n  become: true\n  ansible.builtin.template:\n    src: index.html.j2\n    dest: \"{{ apache_docroot }}/index.html\"\n</code></pre></p> <p>apache/tasks/main.yml : <pre><code>---\n- name: Cargamos modulo de instalacion\n  ansible.builtin.include_tasks: install.yml\n\n- name: Cargamos modulo de despliegue\n  ansible.builtin.include_tasks: deploy.yml\n</code></pre></p> <p>apache/templates/index.html.j2 : <pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"es\"&gt;\n&lt;head&gt;\n  &lt;meta charset=\"UTF-8\"&gt;\n  &lt;title&gt;Listado de Empleados&lt;/title&gt;\n  &lt;style&gt;\n    body {\n      font-family: Arial, sans-serif;\n      background-color: #f4f4f9;\n      color: #333;\n      text-align: center;\n      padding-top: 50px;\n    }\n    h1 { color: #0066cc; }\n    table {\n      margin: 30px auto;\n      border-collapse: collapse;\n      width: 60%;\n      background-color: #fff;\n    }\n    th, td {\n      border: 1px solid #0066cc;\n      padding: 8px;\n    }\n    th {\n      background-color: #e6f0ff;\n    }\n  &lt;/style&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;h1&gt;Listado de empleados&lt;/h1&gt;\n  &lt;table&gt;\n    &lt;thead&gt;\n      &lt;tr&gt;\n        &lt;th&gt;Usuario&lt;/th&gt;\n        &lt;th&gt;Fecha de creaci\u00f3n&lt;/th&gt;\n      &lt;/tr&gt;\n    &lt;/thead&gt;\n    &lt;tbody&gt;\n      {% for emp in employees_list %}\n      &lt;tr&gt;\n        &lt;td&gt;{{ emp.username }}&lt;/td&gt;\n        &lt;td&gt;{{ emp.created_at }}&lt;/td&gt;\n      &lt;/tr&gt;\n      {% endfor %}\n    &lt;/tbody&gt;\n  &lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre></p>"},{"location":"final_project/#3-role-nginx","title":"\ud83d\udcd8 3. Role: nginx","text":"<p>Tras cambiar el puerto por defecto en Apache, volver a configurar el puerto upstream a 8080</p> Solucion <p>nginx/defaults/main.yml : <code>nginx_upstream_port: 9090</code> -&gt; <code>nginx_upstream_port: 8080</code></p>"},{"location":"final_project/#playbook-principal","title":"\ud83d\udcd8 Playbook principal","text":"<p>Crear el playbook principal para orquestar todo el flujo.</p> <p>Note</p> <p>Al tener mas de un servidor tenemos que a\u00f1adir condiciones para que la l\u00f3gica de webservers solo se lance en <code>web1</code> y la l\u00f3gica de base de datos en <code>db1</code>, los servidores que generaba el laboratorio para cada tecnolog\u00eda</p> <p>site.yml <pre><code>---\n- hosts: app\n  gather_facts: true\n  any_errors_fatal: true\n  roles:\n    - role: postgresql\n      when: inventory_hostname == 'db1'\n    - role: apache\n      when: inventory_hostname == 'web1'\n    - role: nginx\n      when: inventory_hostname == 'web1'\n</code></pre></p> <p>Info</p> <p>El ejemplo mostrado anteriormente utiliza inventarios en formato INI, que es el m\u00e1s com\u00fan y sencillo. Sin embargo, Ansible tambi\u00e9n permite definir inventarios en YAML y JSON, lo que aporta m\u00e1s flexibilidad y claridad en estructuras complejas. <pre><code>all:\n  children:\n    webservers:\n      hosts:\n        web1:\n          ansible_host: web1\n    dbservers:\n      hosts:\n        db1:\n          ansible_host: db1\n    app:\n      children:\n        webservers: {}\n        dbservers: {}\n</code></pre></p> <ul> <li>Ambos inventarios representan exactamente la misma estructura l\u00f3gica.</li> <li>El formato YAML es m\u00e1s verbose, pero muy \u00fatil cuando necesitas variables complejas, grupos anidados o definiciones extensas.</li> <li>Ansible detecta autom\u00e1ticamente el formato seg\u00fan la extensi\u00f3n del archivo:<ul> <li><code>.ini</code> \u2192 inventario cl\u00e1sico INI</li> <li><code>.yaml</code> / <code>.yml</code> \u2192 inventario YAML</li> <li><code>.json</code> \u2192 inventario JSON</li> </ul> </li> <li>Documentaci\u00f3n oficial: inventory_guide</li> </ul>"},{"location":"final_project/#nota-sobre-el-uso-de-grupos-en-el-inventario-de-ansible","title":"Nota sobre el uso de grupos en el inventario de Ansible","text":"<p>Cuando trabajamos con varios servidores, es importante estructurar correctamente el inventario de Ansible. Ansible permite agrupar hosts en categor\u00edas l\u00f3gicas (por ejemplo, <code>webservers</code>, <code>dbservers</code>) y tambi\u00e9n crear grupos compuestos mediante <code>:children</code>.</p> <pre><code>[webservers]\nweb1 ansible_host=web1\n\n[dbservers]\ndb1 ansible_host=db1\n\n[app:children]\nwebservers\ndbservers\n</code></pre>"},{"location":"final_project/#que-significa-este-inventario","title":"\u00bfQu\u00e9 significa este inventario?","text":"<ul> <li>webservers: contiene los nodos dedicados a servicios web.</li> <li>dbservers: contiene nodos con bases de datos.</li> <li>app:children: grupo que incluye autom\u00e1ticamente todos los hosts de <code>webservers</code> y <code>dbservers</code>.</li> </ul> <p>Esto permite ejecutar un playbook de forma m\u00e1s sencilla:</p> <pre><code>ansible-playbook -i inventory app.yml\n</code></pre> <p>El playbook se aplicar\u00e1 tanto sobre web1 como db1, sin necesidad de enumerarlos individualmente.</p>"},{"location":"final_project/#ejecucion-esperada","title":"\ud83d\ude80 Ejecuci\u00f3n esperada","text":"<p>Tras ejecutar:</p> <pre><code>ansible-playbook site.yml\n</code></pre> <p>debes poder acceder desde tu navegador a:</p> <pre><code>http://localhost/\n</code></pre> <p>y ver una lista din\u00e1mica de empleados obtenida desde PostgreSQL (el n\u00famero de entradas pueda variar seg\u00fan las veces que se lance en playbook)</p> <p></p>"},{"location":"introduction/","title":"Introduccion","text":""},{"location":"introduction/#1-introduccion-a-ansible","title":"\ud83e\udde9 1: Introducci\u00f3n a Ansible","text":""},{"location":"introduction/#objetivos","title":"\ud83c\udfaf Objetivos","text":"<p>Al finalizar este m\u00f3dulo, ser\u00e1s capaz de:</p> <ol> <li>Comprender qu\u00e9 es Ansible y para qu\u00e9 se utiliza en la automatizaci\u00f3n de sistemas</li> <li>Instalar Ansible en un entorno Linux utilizando el gestor de paquetes correspondiente</li> <li>Configurar los archivos b\u00e1sicos (<code>inventory</code>, <code>ansible.cfg</code>) para ejecutar tareas</li> <li>Ejecutar un primer playbook de ejemplo en el de laboratorio</li> <li>Verificar la conectividad y autenticaci\u00f3n entre el nodo de control y los nodos gestionados</li> </ol>"},{"location":"introduction/#teoria","title":"\ud83e\udde0 Teor\u00eda","text":""},{"location":"introduction/#que-es-ansible","title":"\u00bfQu\u00e9 es Ansible?","text":"<p>Ansible es una herramienta de automatizaci\u00f3n IT que permite gestionar configuraciones, desplegar aplicaciones y orquestar tareas complejas de infraestructura de forma declarativa y sin agentes.</p> <ul> <li>Sin agentes: No requiere instalar software en los servidores gestionados.</li> <li>Usa SSH: La comunicaci\u00f3n se realiza mediante SSH (o WinRM en Windows).</li> <li>Declarativo: Describe el estado deseado, no los pasos para alcanzarlo.</li> </ul> <p>Note</p> <p>Ansible fue creado por Michael DeHaan en 2012 y actualmente es mantenido por Red Hat. Es una de las herramientas m\u00e1s usadas en entornos DevOps, junto con Terraform y Puppet.</p>"},{"location":"introduction/#arquitectura-basica","title":"Arquitectura B\u00e1sica","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Nodo de Control    \u2502\n\u2502 (ansible instalado)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502 SSH\n         \u25bc\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Nodos Gestionados   \u2502\n\u2502 (servidores remotos)\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"introduction/#conceptos-fundamentales","title":"Conceptos Fundamentales","text":"<p>Antes de comenzar a ejecutar comandos o playbooks, vamosa a repasar los conceptos b\u00e1sicos del ecosistema de Ansible:</p>"},{"location":"introduction/#nodo-de-control-control-node","title":"\ud83d\udda5\ufe0f Nodo de Control (Control Node)","text":"<p>Es la m\u00e1quina que tiene instalado el motor y desde la que ejecutamos los comandos de Ansible (<code>ansible</code>, <code>ansible-playbook</code>, <code>ansible-vault</code>, etc.).</p> <ul> <li>Puede ser un ordenador local, un servidor o incluso un contenedor (Execution Environment).</li> <li>Es el punto central de operaci\u00f3n: desde aqu\u00ed se orquestan las tareas hacia los nodos gestionados.</li> </ul> <p>Tip</p> <p>Cualquier m\u00e1quina con Python y acceso SSH a los servidores gestionados puede actuar como nodo de control.</p>"},{"location":"introduction/#nodos-gestionados-managed-nodes","title":"\ud83d\udcbb Nodos Gestionados (Managed Nodes)","text":"<p>Tambi\u00e9n llamados hosts, son los dispositivos o servidores que Ansible administra. Pueden ser servidores Linux, Windows o cualquier sistema accesible por red, donde se pueda instalar python (se usa como dependencia)</p> <p>Note</p> <p>Ansible no se instala en ellos El nodo de control se conecta mediante SSH o WinRM y genera los recursos temporales necesarios</p>"},{"location":"introduction/#inventario-inventory","title":"\ud83d\udccb Inventario (Inventory)","text":"<p>Es una lista de nodos gestionados, organizada por grupos.</p> <p>El inventario puede ser:</p> <ul> <li>Un archivo est\u00e1tico (<code>inventory</code>, <code>hosts</code>)</li> <li>O una fuente din\u00e1mica (por ejemplo, AWS EC2, VMware, Docker, etc.)</li> </ul> <p>Ejemplo b\u00e1sico de inventario est\u00e1tico:</p> <pre><code>[webservers]\nweb1 ansible_host=192.168.1.10\nweb2 ansible_host=192.168.1.11\n\n[dbservers]\ndb1 ansible_host=192.168.1.20\n</code></pre> <p>Note</p> <p>El inventario tambi\u00e9n puede definir variables por host o grupo, que luego se usan dentro de los playbooks.</p>"},{"location":"introduction/#tareas-tasks","title":"\ud83e\uddf1 Tareas (Tasks)","text":"<p>Cada tarea define una acci\u00f3n espec\u00edfica que se aplica sobre los nodos gestionados.</p> <p>Ejemplo:</p> <pre><code>- name: Crear un archivo vac\u00edo\n  ansible.builtin.file:\n    path: /tmp/test.txt\n    state: touch\n</code></pre>"},{"location":"introduction/#roles","title":"\ud83e\udde9 Roles","text":"<p>Un role es una forma estructurada y reutilizable de empaquetar contenido de Ansible:</p> Directorio Prop\u00f3sito Principal Explicaci\u00f3n Breve <code>tasks/</code> Flujo de Ejecuci\u00f3n Contiene los archivos YAML (<code>main.yml</code>) que definen las acciones (tareas) que Ansible debe realizar en los hosts (p. ej., instalar paquetes, crear usuarios, copiar archivos). <code>handlers/</code> Manejo de Eventos Contiene los handlers (manejadores) que son tareas que solo se ejecutan cuando son notificadas (o notified) por una tarea en <code>tasks/</code>. Se usan generalmente para reiniciar servicios, lo cual solo debe hacerse si la configuraci\u00f3n ha cambiado. <code>vars/</code> Variables por Defecto Almacena variables espec\u00edficas para este role (en <code>main.yml</code>). Son variables que el role necesita, pero que pueden ser sobrescritas desde el playbook o el inventario. <code>defaults/</code> Valores Preestablecidos (Aunque no lo mencionaste, es crucial). Contiene variables (en <code>main.yml</code>) que establecen los valores predeterminados para el role. Tienen la menor prioridad, asegurando que el role siempre funcione con valores seguros si no se especifican otros. <code>templates/</code> Archivos Din\u00e1micos (Jinja2) Contiene plantillas de archivos (usualmente con extensi\u00f3n <code>.j2</code>) que se copian al host gestionado. Antes de copiarse, Ansible reemplaza las variables definidas en Jinja2 (<code>{{ variable }}</code>) con sus valores reales. <code>files/</code> Archivos Est\u00e1ticos Contiene archivos est\u00e1ticos que deben copiarse tal cual a los hosts gestionados. Se accede a ellos usando el m\u00f3dulo <code>copy</code> o <code>template</code>, pero no se procesan como plantillas. <code>meta/</code> Metadatos y Dependencias Contiene informaci\u00f3n sobre el role mismo, como su autor, licencia, plataformas compatibles, y, lo m\u00e1s importante, las dependencias de otros roles que deben ejecutarse antes que este. <p>La diferencia principal entre <code>vars/</code> y <code>defaults/</code> es la prioridad de las variables (lo veremos m\u00e1s adelante).</p> <p>Tip</p> <p>Los roles permiten modularizar tus automatizaciones y reutilizar c\u00f3digo entre proyectos.</p> <p>Para usarlos, basta con incluirlos dentro de un play:</p> <pre><code>roles:\n  - common\n  - webserver\n</code></pre>"},{"location":"introduction/#handlers","title":"\ud83d\udece\ufe0f Handlers","text":"<p>Son tareas especiales que solo se ejecutan cuando son notificadas por otras tareas que cambian algo.</p> <p>Ejemplo:</p> <pre><code>tasks:\n  - name: Copiar archivo de configuraci\u00f3n\n    ansible.builtin.copy:\n      src: nginx.conf\n      dest: /etc/nginx/nginx.conf\n    notify: Reiniciar Nginx # llamada la handler con \"name: Reiniciar Nginx\"\n\nhandlers:\n  - name: Reiniciar Nginx # el nombre tiene que coincidir con el campo \"notify\"\n    ansible.builtin.service:\n      name: nginx\n      state: restarted\n</code></pre>"},{"location":"introduction/#plays","title":"\u25b6\ufe0f Plays","text":"<p>Un play encapsula una lista ordenada de acciones contra un conjunto de hosts.</p> <p>Cada play puede incluir variables, roles, handlers y tareas.</p> <p>Podemos pensar en un play como:</p> <p>\u201cEjecutar estas tareas sobre estos servidores, de esta forma.\u201d</p>"},{"location":"introduction/#playbooks","title":"\ud83c\udfae Playbooks","text":"<p>Los playbooks son archivos escritos en YAML que definen qu\u00e9 tareas ejecutar y sobre qu\u00e9 hosts.</p> <ul> <li>Son el la pieza principal de Ansible</li> <li>Cada playbook contiene uno o varios plays</li> </ul> <p>Ejemplo de un playbook b\u00e1sico:</p> <pre><code>---\n- name: Instalar Apache en los servidores web # Nombre del play\n  hosts: webservers # grupo de servidores\n  become: true # se lanza como 'root'\n  tasks:\n    - name: Instalar paquete Apache\n      ansible.builtin.package:\n        name: apache2\n        state: present\n</code></pre>"},{"location":"introduction/#modulos-modules","title":"\u2699\ufe0f M\u00f3dulos (Modules)","text":"<p>Los m\u00f3dulos son paquetes de c\u00f3digo que Ansible copia temporalmente a los nodos gestionados para ejecutar acciones espec\u00edficas.</p> <ul> <li>Existen m\u00f3dulos para administrar paquetes, usuarios, bases de datos, redes, etc.</li> <li>Se agrupan en colecciones (collections).</li> </ul> <p>Ejemplo:</p> <pre><code>- name: Instalar paquete Nginx\n  ansible.builtin.package:\n    name: nginx\n    state: present\n</code></pre> <p>Note</p> <p>Los m\u00f3dulos son autocontenidos y declarativos: definen qu\u00e9 debe lograrse, no c\u00f3mo.</p>"},{"location":"introduction/#plugins","title":"\ud83d\udd0c Plugins","text":"<p>Los plugins ampl\u00edan las capacidades del n\u00facleo de Ansible</p> <p>Tipos de plugins comunes:</p> <ul> <li>Connection plugins: controlan c\u00f3mo se conecta Ansible (SSH, WinRM, local, Docker\u2026)</li> <li>Filter plugins: manipulan datos y variables</li> <li>Callback plugins: controlan la salida y formato del resultado</li> </ul>"},{"location":"introduction/#colecciones-collections","title":"\ud83d\udce6 Colecciones (Collections)","text":"<p>Las colecciones agrupan el contenido de Ansible: roles, m\u00f3dulos, plugins y playbooks</p> <p>Se instalan f\u00e1cilmente desde Ansible Galaxy:</p> <pre><code>ansible-galaxy collection install ansible.posix\n</code></pre> <p>Tip</p> <p>Usa colecciones oficiales (por ejemplo <code>ansible.builtin</code>, <code>community.general</code>) para mantener compatibilidad y seguridad.</p>"},{"location":"introduction/#archivos-fundamentales","title":"Archivos Fundamentales","text":"<ol> <li> <p>El ya comentado Inventario (<code>inventory</code>)     Lista de hosts o grupos de hosts que Ansible gestionar\u00e1:</p> <pre><code>[webservers]\nweb1 ansible_host=192.168.1.10\nweb2 ansible_host=192.168.1.11\n\n[dbservers]\ndb1 ansible_host=192.168.1.20\n</code></pre> </li> <li> <p>Y el archivo de configuraci\u00f3n (<code>ansible.cfg</code>)     Controla el comportamiento global de Ansible.</p> <pre><code>[defaults]\ninventory = ./inventory\nhost_key_checking = False\n</code></pre> </li> </ol> <p>Danger</p> <p>En entornos productivos <code>host_key_checking</code> debe estar siempre a <code>True</code> para evitar server spoofing y ataques man-in-the-middle</p> <p>Tip</p> <p>Puedes establecer una configuraci\u00f3n global en <code>/etc/ansible/ansible.cfg</code> o local por proyecto (recomendado) en el directorio de trabajo.</p>"},{"location":"introduction/#ejemplo-practico","title":"\u270d\ufe0f Ejemplo Pr\u00e1ctico","text":""},{"location":"introduction/#0-requisitos","title":"0. Requisitos","text":"<ul> <li>Python &gt;= 3.10</li> </ul>"},{"location":"introduction/#1-instalar-ansible","title":"1. Instalar Ansible","text":"<p>Crear un virtual enviroment de trabajo: <pre><code>python -m venv venv\nsource venv/bin/activate\n</code></pre></p> <p>Instalar ansible-core: <pre><code>pip install ansible-core==2.16.14\n</code></pre></p> <p>Verifica la versi\u00f3n instalada: <pre><code>ansible --version\n</code></pre></p>"},{"location":"introduction/#2-crear-un-inventario-simple","title":"2. Crear un Inventario Simple","text":"<p>Con tu editor de confianza, crea el archivo <code>inventory</code>:</p> <pre><code>[all]\nlocalhost ansible_connection=local\n</code></pre> <p>y <code>ansible.cfg</code>: <pre><code>[defaults]\ninventory = ./inventory\nhost_key_checking = False # no\n</code></pre></p>"},{"location":"introduction/#3-validar-configuracion-local","title":"3. Validar configuraci\u00f3n local","text":"<p>Lanzamos el siguiente comando:</p> <pre><code>ansible -m ping localhost\n</code></pre> <p>Salida esperada:</p> <pre><code>localhost | SUCCESS =&gt; {\n    \"changed\": false,\n    \"ping\": \"pong\"\n}\n</code></pre> <p>Note</p> <p>El m\u00f3dulo <code>ping</code> no hace un ping de red real, sino una verificaci\u00f3n de conectividad y autenticaci\u00f3n con el host sobre SSH</p>"},{"location":"introduction/#errores-comunes-y-buenas-practicas","title":"\ud83d\udea8 Errores Comunes y Buenas Pr\u00e1cticas","text":""},{"location":"introduction/#errores-comunes","title":"Errores Comunes","text":"<ol> <li> <p>Error de autenticaci\u00f3n SSH</p> <p><pre><code>UNREACHABLE! =&gt; Failed to connect to the host via ssh\n</code></pre> \u2192 Revisa las claves SSH y permisos</p> </li> <li> <p>Inventario mal formateado     \u2192 Aseg\u00farate de que no haya espacios o tabulaciones incorrectas en el archivo <code>inventory</code></p> </li> <li> <p>Ruta incorrecta del <code>ansible.cfg</code>   \u2192 Usa <code>ansible --version</code> para verificar desde d\u00f3nde se est\u00e1 leyendo la configuraci\u00f3n</p> </li> </ol>"},{"location":"introduction/#buenas-practicas","title":"Buenas Pr\u00e1cticas","text":"<p>Tip</p> <ul> <li>Usa inventarios por entorno (dev, stage, prod) o tecnolog\u00eda (oracle, mongo)</li> <li>Define un <code>ansible.cfg</code> por proyecto para mantener configuraciones aisladas</li> </ul>"},{"location":"introduction/#ejercicio-propuesto","title":"\ud83d\udcda Ejercicio Propuesto","text":"<p>Crea un entorno b\u00e1sico y verifica conectividad entre tu nodo de control y un servidor remoto.</p> <ol> <li>Instala Ansible.</li> <li>Configura un archivo <code>inventory</code> con localhost como host remoto</li> <li>Crea un playbook <code>check.yml</code> que:<ul> <li>Use el m\u00f3dulo <code>ping</code></li> </ul> </li> </ol> <p>Tip</p> <p>Si todo est\u00e1 bien configurado, deber\u00edas ver un mensaje de \u00e9xito similar a: <pre><code>localhost | SUCCESS =&gt; {\n    \"changed\": false,\n    \"ping\": \"pong\"\n}\n</code></pre></p>"},{"location":"task_roles_handlers/","title":"Tasks, Roles y Handlers","text":""},{"location":"task_roles_handlers/#4-manejo-de-tareas-roles-y-handlers","title":"\ud83e\udde9 4: Manejo de Tareas, Roles y Handlers","text":""},{"location":"task_roles_handlers/#objetivos","title":"\ud83c\udfaf Objetivos","text":"<p>Al finalizar este m\u00f3dulo ser\u00e1s capaz de:</p> <ol> <li>Organizar tareas dentro de un playbook de forma limpia y estructurada.</li> <li>Crear y utilizar roles para separar l\u00f3gica y reutilizar c\u00f3digo.</li> <li>Definir y ejecutar handlers para gestionar reinicios, recargas o acciones condicionales.</li> <li>Aplicar buenas pr\u00e1cticas de estructura en proyectos Ansible.</li> </ol>"},{"location":"task_roles_handlers/#teoria","title":"\ud83e\udde0 Teor\u00eda","text":""},{"location":"task_roles_handlers/#que-son-las-tasks","title":"\u00bfQu\u00e9 son las Tasks?","text":"<p>Las tasks son el conjuto de acciones que Ansible ejecuta sobre los hosts: instalar paquetes, crear archivos, gestionar servicios, etc, apoyandose en los diferentes m\u00f3dulos. Se definen dentro de <code>tasks:</code> en un playbook o en archivos externos.</p> <p>Ejemplo b\u00e1sico:</p> <pre><code>tasks:\n  - name: Instalar Nginx\n    ansible.builtin.package:\n      name: nginx\n      state: present\n</code></pre> <p>Las tareas se ejecutan de arriba a abajo en el orden en que aparecen.</p>"},{"location":"task_roles_handlers/#separacion-de-tareas-en-archivos","title":"Separaci\u00f3n de Tareas en Archivos","text":"<p>Para playbooks grandes, es com\u00fan mover las tareas a archivos externos. Esto permite playbooks m\u00e1s limpios y estructurados:</p>"},{"location":"task_roles_handlers/#mainyml","title":"<code>main.yml</code>","text":"<pre><code>- hosts: localhost\n  tasks:\n    - name: Incluir tareas\n      ansible.builtin.include_tasks: tasks/web.yml\n</code></pre>"},{"location":"task_roles_handlers/#taskswebyml","title":"<code>tasks/web.yml</code>","text":"<pre><code>- name: Crear directorio web\n  ansible.builtin.file:\n    path: /tmp/web\n    state: directory\n</code></pre>"},{"location":"task_roles_handlers/#roles","title":"\ud83c\udfd7\ufe0f Roles","text":"<p>Los roles son la forma est\u00e1ndar y recomendada de organizar, modularizar y reutilizar l\u00f3gica en Ansible. Un rol encapsula:</p> <ul> <li>Defaults (Variables por defecto)</li> <li>Tareas (Tasks)</li> <li>Variables (Vars)</li> <li>Handlers</li> <li>Archivos (Files)</li> <li>Plantillas (Templates)</li> </ul> <p>Abstract</p> <p>Link a la documentaci\u00f3n oficial</p>"},{"location":"task_roles_handlers/#estructura-interna-de-un-rol","title":"Estructura interna de un rol","text":"<p>Estructura t\u00edpica:</p> <pre><code>roles/\n\u2514\u2500\u2500 webserver/\n    \u251c\u2500\u2500 tasks/\n    \u2502   \u251c\u2500\u2500 main.yml\n    \u2502   \u2514\u2500\u2500 install.yml\n    \u2502   \u2514\u2500\u2500 configure.yml\n    \u251c\u2500\u2500 handlers/\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 templates/\n    \u2502   \u2514\u2500\u2500 index.html.j2\n    \u251c\u2500\u2500 files/\n    \u2502   \u2514\u2500\u2500 static_file.txt\n    \u251c\u2500\u2500 vars/\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 defaults/\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u251c\u2500\u2500 meta/\n    \u2502   \u2514\u2500\u2500 main.yml\n    \u2514\u2500\u2500 README.md\n</code></pre> <p>No es obligatorio usar todas las carpetas, pero tasks/ y templates/ suelen ser esenciales.</p>"},{"location":"task_roles_handlers/#como-funciona-un-rol-internamente","title":"\u00bfC\u00f3mo funciona un rol internamente?","text":"<p>El punto de entrada es siempre <code>tasks/main.yml</code>. Es equivalente al <code>main()</code> de un programa.</p> <p>Ejemplo:</p> <pre><code># roles/webserver/tasks/main.yml\n- name: Instalar paquetes\n  ansible.builtin.include_tasks: install.yml\n\n- name: Configurar archivos\n  ansible.builtin.include_tasks: configure.yml\n</code></pre> <p><code>main.yml</code> orquesta internamente el rol, ejecutando secuencialmente otros archivos de tareas. Tambi\u00e9n puede contener toda la l\u00f3gica directamente, pero no es una pr\u00e1ctica recomendable por mantenibilidad.</p> <p>Esto permite dividir la l\u00f3gica:</p> <ul> <li><code>install.yml</code> \u2192 instalaci\u00f3n de paquetes</li> <li><code>configure.yml</code> \u2192 plantillas, permisos, etc.</li> <li><code>validate.yml</code> \u2192 comprobaciones finales</li> </ul> <p>Orden t\u00edpico:</p> <ol> <li><code>tasks/main.yml</code></li> <li>Cualquier include/import dentro del main</li> <li>handlers al final del play, si fueron notificados</li> </ol>"},{"location":"task_roles_handlers/#variables-internas-del-rol","title":"Variables internas del rol","text":"<p><code>defaults/main.yml</code></p> <ul> <li>Prioridad m\u00e1s baja de Ansible.</li> <li>Perfecto para valores por defecto que el usuario puede sobrescribir.</li> </ul> <p>Ejemplo:</p> <pre><code># roles/webserver/defaults/main.yml\nweb_port: 80\nweb_root: /var/www/html\n</code></pre> <p><code>vars/main.yml</code></p> <ul> <li>Alta prioridad.</li> <li>Poco recomendado salvo casos especiales.</li> </ul> <p>Ejemplo:</p> <pre><code># roles/webserver/vars/main.yml\nnginx_package_name: nginx\n</code></pre>"},{"location":"task_roles_handlers/#plantillas-y-archivos-del-rol","title":"Plantillas y archivos del rol","text":"<p>Se acceden dentro del rol sin rutas relativas:</p> <pre><code>ansible.builtin.template:\n  src: index.html.j2\n  dest: \"{{ web_root }}/index.html\"\n</code></pre> <pre><code>ansible.builtin.copy:\n  src: static_file.txt\n  dest: /tmp/static_file.txt\n</code></pre>"},{"location":"task_roles_handlers/#dependencias-entre-roles","title":"Dependencias entre roles","text":"<p>Se declaran en: <code>roles/webserver/meta/main.yml</code></p> <pre><code>dependencies:\n  - role: common\n  - role: firewall\n</code></pre>"},{"location":"task_roles_handlers/#ejemplo-completo-de-rol","title":"Ejemplo completo de rol","text":"<p>Tenemos el role <code>webserver</code>, las partes de este ser\u00edan:</p> <ol> <li><code>roles/webserver/tasks/main.yml</code></li> </ol> <pre><code>- name: Incluir instalacion\n  ansible.builtin.include_tasks: install.yml\n\n- name: Incluir configuracion\n  ansible.builtin.include_tasks: configure.yml\n</code></pre> <ol> <li><code>roles/webserver/tasks/install.yml</code></li> </ol> <pre><code>- name: Instalar nginx\n  ansible.builtin.package:\n    name: nginx\n    state: present\n</code></pre> <ol> <li><code>roles/webserver/tasks/configure.yml</code></li> </ol> <pre><code>- name: Deploy del index.html\n  ansible.builtin.template:\n    src: index.j2\n    dest: \"{{ web_root }}/index.html\"\n  notify: Recargar nginx\n</code></pre> <ol> <li><code>roles/webserver/handlers/main.yml</code></li> </ol> <pre><code>- name: Recargar nginx\n  ansible.builtin.service:\n    name: nginx\n    state: reloaded\n</code></pre>"},{"location":"task_roles_handlers/#usar-un-rol-en-un-playbook","title":"Usar un rol en un playbook","text":"<pre><code>- hosts: webservers\n  roles:\n    - webserver\n</code></pre> <p>O con par\u00e1metros:</p> <pre><code>- hosts: webservers\n  roles:\n    - role: webserver\n      web_port: 8080\n</code></pre>"},{"location":"task_roles_handlers/#handlers","title":"\ud83d\udd25 Handlers","text":"<p>Los handlers son tareas especiales que se ejecutan solo cuando son notificadas por otra tarea.</p> <p>Ejemplo t\u00edpico: reiniciar un servicio solo cuando hay cambios</p> <pre><code>tasks:\n  - name: Copiar archivo de configuraci\u00f3n\n    ansible.builtin.template:\n      src: nginx.conf.j2\n      dest: /etc/nginx/nginx.conf\n    notify: Reiniciar nginx\n\nhandlers:\n  - name: Reiniciar nginx\n    ansible.builtin.service:\n      name: nginx\n      state: restarted\n</code></pre> <p>Caracter\u00edsticas:</p> <ul> <li>Solo se ejecutan si hubo cambios en la tarea que los notifica</li> <li>Se ejecutan al final del play, despu\u00e9s de todas las tareas</li> <li>Se pueden notificar varias veces, pero solo se ejecutan una vez</li> <li>Pueden estar dentro de un rol en su carpeta <code>handlers/</code></li> </ul> <p>Tip</p> <p>Se puede forzar que los handlers se ejecuten en un determinado momento usando sin esperar al final <pre><code>- ansible.builtin.meta: flush_handlers\n</code></pre></p>"},{"location":"task_roles_handlers/#encadenamiento-de-handlers","title":"\ud83e\uddec Encadenamiento de Handlers","text":"<p>Se pueden encadenar handlers usando <code>notify</code> dentro de un handler:</p> <pre><code>handlers:\n  - name: Reload nginx\n    ansible.builtin.service:\n      name: nginx\n      state: reloaded\n    notify: Restart nginx\n\n  - name: Restart nginx\n    ansible.builtin.service:\n      name: nginx\n      state: restarted\n</code></pre>"},{"location":"task_roles_handlers/#errores-comunes-y-buenas-practicas","title":"\ud83d\udea8 Errores Comunes y Buenas Pr\u00e1cticas","text":""},{"location":"task_roles_handlers/#errores-comunes","title":"Errores Comunes","text":"<ol> <li> <p>Diferencia entre <code>include_tasks</code> y <code>import_tasks</code></p> <ul> <li><code>import_tasks</code> \u2192 est\u00e1tico, se carga en parse time</li> <li><code>include_tasks</code> \u2192 din\u00e1mico, se eval\u00faa en runtime</li> </ul> <p>Ejemplo: <pre><code>import_tasks: install.yml\nwhen: some_condition\n</code></pre> \u2192 No funciona: <code>import_tasks</code> ignora el <code>when</code></p> </li> </ol>"},{"location":"task_roles_handlers/#buenas-practicas","title":"Buenas Pr\u00e1cticas","text":"<p>Tip</p> <ul> <li>Divide <code>tasks/main.yml</code> en m\u00faltiples includes para mayor claridad</li> <li>Pon variables modificables en <code>defaults/</code>, no en <code>vars/</code></li> <li>Usa nombres de variables con prefijo del rol: <code>webserver_port</code>, <code>webserver_root</code></li> <li>Mant\u00e9n los roles autocontenidos: no dependas del proyecto</li> <li>Usa handlers solo para acciones idempotentes y necesarias</li> <li>Evita rutas absolutas dentro del rol cuando puedas parametrizar</li> <li>Documenta el rol (README.md dentro del rol)</li> </ul>"},{"location":"task_roles_handlers/#ejercicio-practico","title":"\ud83d\udcda Ejercicio Pr\u00e1ctico","text":"<p>Crear un rol llamado <code>webdemo</code> que encapsule lo l\u00f3gica del ejercicio del tema anterior.</p> <p>Para iniciar el ejercicio, ejecuta: <pre><code>lab start role\n</code></pre> Esto generar\u00e1 la estructura:</p> <pre><code>webdemo/\n\u251c\u2500\u2500 defaults/\n\u2502   \u2514\u2500\u2500 main.yml\n\u251c\u2500\u2500 tasks/\n\u2502   \u2514\u2500\u2500 main.yml\n\u2514\u2500\u2500 ...\n</code></pre> <p>1. Define las variables por defecto del rol</p> <p>En <code>webdemo/defaults/main.yml</code>: <pre><code>web_port: 8080\nweb_root: /tmp/demo\n</code></pre></p> <p>2. Implementa las tareas del rol</p> <p>En <code>webdemo/tasks/main.yml</code>: <pre><code>---\n- name: Incluimos la logica\n  ansible.builtin.include_tasks: action.yml\n</code></pre></p> <p>En <code>webdemo/tasks/action.yml</code>: <pre><code>---\n- name: Crear directorio web_root\n  ansible.builtin.file:\n    path: \"{{ web_root }}\"\n    state: directory\n\n- name: Crear archivo index.html\n  ansible.builtin.copy:\n    content: \"Servidor escuchando en el puerto {{ web_port }}\"\n    dest: \"{{ web_root }}/index.html\"\n</code></pre></p> <p>3. Crea un playbook que use el rol</p> <p>Crea <code>site.yml</code>: <pre><code>---\n- name: Ejecutar rol webdemo\n  hosts: localhost\n  gather_facts: false\n  roles:\n    - role: webdemo\n</code></pre></p> <p>4. Ejecuta playbook completo</p> <pre><code>ansible-playbook site.yml -v\n</code></pre> <p>Para evaluar el ejercicio, ejecuta: <pre><code>lab grade role\n</code></pre></p> <p>\ud83d\udd2c Desaf\u00edo adicional</p> <ul> <li>Agrega una tarea que muestre con <code>debug:</code> la ruta completa del archivo creado</li> <li>Agrega una tarea que muestre con <code>debug:</code> el contenido del archivo creado (se puede hacer en varios pasos)</li> </ul> <pre><code>- name: Mostrar ruta completa del archivo creado\n  ansible.builtin.debug:\n    msg: \"Archivo creado: {{ web_root }}/index.html\"\n\n- name: Leer contenido del archivo creado\n  ansible.builtin.slurp:\n    src: \"{{ web_root }}/index.html\"\n  register: index_raw\n\n- name: Mostrar contenido del archivo creado\n  ansible.builtin.debug:\n    msg: \"{{ index_raw.content | b64decode }}\"\n</code></pre> <p>5. Ejecuta y prueba sobrescribir variables con <code>-e</code></p> <pre><code>ansible-playbook site.yml -e web_port=9090\n</code></pre>"},{"location":"templates/","title":"Templates","text":""},{"location":"templates/#5-templates-y-jinja2-en-ansible","title":"\ud83e\udde9 5: Templates y Jinja2 en Ansible","text":""},{"location":"templates/#objetivos","title":"\ud83c\udfaf Objetivos","text":"<p>Al finalizar este m\u00f3dulo, ser\u00e1s capaz de:</p> <ol> <li>Comprender qu\u00e9 es un template y por qu\u00e9 es fundamental en Ansible</li> <li>Utilizar Jinja2 para generar archivos din\u00e1micos mediante variables, filtros y estructuras l\u00f3gicas</li> <li>Diferenciar entre templates simples y configuraciones avanzadas basadas en l\u00f3gica</li> <li>Integrar templates dentro de roles y playbooks correctamente</li> <li>Aplicar buenas pr\u00e1cticas para mantener plantillas limpias, legibles y mantenibles</li> </ol>"},{"location":"templates/#teoria","title":"\ud83e\udde0 Teor\u00eda","text":""},{"location":"templates/#que-es-un-template-en-ansible","title":"\u00bfQu\u00e9 es un Template en Ansible?","text":"<p>Un template es un archivo de texto que usa la sintaxis de Jinja2 para generar contenido din\u00e1mico. Se utiliz\u00e1n t\u00edpicamente para:</p> <ul> <li>Configuraciones de servicios (<code>nginx.conf</code>, <code>php.ini</code>, <code>my.cnf</code>, <code>sshd_config</code>, etc.)</li> <li>Scripts con par\u00e1metros</li> <li>Archivos de entorno <code>.env</code></li> <li>Configuraci\u00f3n multi-host</li> </ul> <p>Se procesan con el m\u00f3dulo:</p> <pre><code>ansible.builtin.template\n</code></pre> <p>Los templates siempre viven en:</p> <pre><code>templates/\n</code></pre> <p>dentro del rol o del proyecto.</p>"},{"location":"templates/#que-es-jinja2","title":"\u00bfQu\u00e9 es Jinja2?","text":"<p>Jinja2 es un motor de plantillas que permite:</p> <ul> <li>Insertar variables</li> <li>Crear condicionales (<code>if</code>)</li> <li>Iteraciones (<code>for</code>)</li> <li>Aplicar filtros (<code>| lower</code>, <code>| default()</code>, etc.)</li> </ul> <p>Ejemplo b\u00e1sico:</p> <pre><code>server {\n    listen {{ web_port }};\n    root {{ web_root }};\n}\n</code></pre>"},{"location":"templates/#sintaxis-jinja2-esencial","title":"\ud83d\udcc4 Sintaxis Jinja2 Esencial","text":""},{"location":"templates/#variables","title":"Variables","text":"<pre><code>Usuario: {{ user_name }}\n</code></pre>"},{"location":"templates/#condicionales","title":"Condicionales","text":"<pre><code>{% if enable_ssl %}\nssl on;\n{% else %}\nssl off;\n{% endif %}\n</code></pre>"},{"location":"templates/#bucles","title":"Bucles","text":"<pre><code>{% for host in groups['webservers'] %}\nserver {{ host }};\n{% endfor %}\n</code></pre>"},{"location":"templates/#filtros-utiles","title":"Filtros \u00fatiles","text":"<pre><code>{{ web_root | default('/var/www/html') }}\n\n{{ app_name | upper }}\n\n{{ servers | join(', ') }}\n</code></pre>"},{"location":"templates/#uso-de-templates-en-playbooks-y-roles","title":"\u2699\ufe0f Uso de Templates en Playbooks y Roles","text":""},{"location":"templates/#ejemplo-basico-en-un-playbook","title":"Ejemplo b\u00e1sico en un playbook","text":"<pre><code>- hosts: web\n  tasks:\n    - name: Generar archivo de configuraci\u00f3n de Nginx\n      ansible.builtin.template:\n        src: nginx.conf.j2\n        dest: /etc/nginx/nginx.conf\n        mode: '0644'\n</code></pre>"},{"location":"templates/#ejemplo-dentro-de-un-rol","title":"Ejemplo dentro de un rol","text":"<pre><code>roles/\n\u2514\u2500\u2500 webserver/\n    \u251c\u2500\u2500 tasks/main.yml\n    \u2514\u2500\u2500 templates/nginx.conf.j2\n</code></pre> <p><code>tasks/main.yml</code>:</p> <pre><code>- name: Plantilla de configuraci\u00f3n de Nginx\n  ansible.builtin.template:\n    src: nginx.conf.j2\n    dest: \"/etc/nginx/conf.d/{{ inventory_hostname }}.conf\"\n</code></pre>"},{"location":"templates/#ejemplos-reales-de-jinja2-en-configuracion","title":"\ud83d\udcda Ejemplos Reales de Jinja2 en Configuraci\u00f3n","text":""},{"location":"templates/#1-configuracion-con-lista-de-backends","title":"1. Configuraci\u00f3n con lista de backends","text":"<p>Template: <pre><code>upstream backend {\n{% for srv in backend_servers %}\n  server {{ srv }}:{{ backend_port }};\n{% endfor %}\n}\n</code></pre></p> <p>Playbook: <pre><code>vars:\n  backend_servers:\n    - 10.0.0.10\n    - 10.0.0.11\n  backend_port: 9000\n</code></pre></p>"},{"location":"templates/#2-configuracion-condicional-de-logs","title":"2. Configuraci\u00f3n condicional de logs","text":"<pre><code>{% if enable_debug %}\nerror_log /var/log/nginx/error.log debug;\n{% else %}\nerror_log /var/log/nginx/error.log warn;\n{% endif %}\n</code></pre>"},{"location":"templates/#3-crear-un-archivo-env-dinamico","title":"3. Crear un archivo <code>.env</code> din\u00e1mico","text":"<pre><code>APP_ENV={{ app_env }}\nDEBUG={{ debug | default(false) }}\nDB_HOST={{ db.host }}\nDB_USER={{ db.user }}\nDB_PASS={{ db.pass }}\n</code></pre>"},{"location":"templates/#errores-comunes-y-buenas-practicas","title":"\ud83d\udea8 Errores Comunes y Buenas Pr\u00e1cticas","text":""},{"location":"templates/#errores-comunes","title":"Errores Comunes","text":"<ol> <li>Variables no definidas</li> </ol> <p>Soluci\u00f3n: <code>{{ var | default('valor') }}</code></p> <ol> <li> <p>Espacios mal puestos en el delimitador</p> <p><pre><code>{%if enabled%}   # \u274c No hay espacios despu\u00e9s de {%\n{% if enabled%}  # \u274c Falta el espacio antes de %}\n</code></pre> {% y %} deben estar unidos al contenido sin pegarse <pre><code>{% if enabled %}\n</code></pre></p> </li> </ol>"},{"location":"templates/#buenas-practicas","title":"Buenas Pr\u00e1cticas","text":"<p>Tip</p> <ul> <li>Usa <code>default()</code> en TODAS las variables cr\u00edticas.</li> <li>Usa comentarios dentro del template (<code>#</code>) para documentar decisiones.</li> <li>Evita hardcodear rutas; usa variables (<code>{{ config_dir }}</code>).</li> <li>Prefiere variables con nombre expl\u00edcito: <code>nginx_log_format</code> en vez de <code>log</code>.</li> <li>Prueba el template con <code>ansible-playbook --check</code> antes de recargar un servicio sensible.</li> </ul>"},{"location":"vars/","title":"Variables","text":""},{"location":"vars/#3-prioridad-de-variables-en-ansible","title":"\ud83e\udde9 3: Prioridad de variables en Ansible","text":""},{"location":"vars/#objetivos","title":"\ud83c\udfaf Objetivos","text":"<p>Al finalizar este m\u00f3dulo, ser\u00e1s capaz de:</p> <ol> <li>Definir variables en distintos niveles de Ansible (inventario, playbook, roles, etc.)</li> <li>Comprender la precedencia y prioridades entre ellas</li> <li>Utilizar variables de entorno, facts y prompts dentro de playbooks</li> <li>Aplicar buenas pr\u00e1cticas en el uso de variables</li> </ol>"},{"location":"vars/#teoria","title":"\ud83e\udde0 Teor\u00eda","text":""},{"location":"vars/#que-son-las-variables-en-ansible","title":"\u00bfQu\u00e9 son las Variables en Ansible?","text":"<p>Las variables permiten parametrizar los playbooks y tareas para que sean reutilizables y flexibles. Pueden almacenar valores como rutas, nombres de paquetes, usuarios, direcciones IP, contrase\u00f1as, etc.</p> <p>Ejemplo:</p> <pre><code>- name: Instalar paquete configurable\n  hosts: localhost\n  vars:\n    pkg_name: nginx\n  tasks:\n    - name: Instalar paquete\n      ansible.builtin.package:\n        name: \"{{ pkg_name }}\"\n        state: present\n</code></pre> <p>Note</p> <p>Las variables se expanden con doble llave <code>{{ variable }}</code></p> <p>Deben entrecomillarse cuando se usan al inicio:    <code>app_path: {{ base_path }}/22</code> \u279c <code>app_path: \"{{ base_path }}/22\"</code></p> <p>Pueden usarse en cualquier parte de un playbook: rutas, nombres, comandos, etc.</p>"},{"location":"vars/#donde-definir-variables","title":"\ud83d\udcdc D\u00f3nde Definir Variables","text":"<p>Ansible permite definir variables en muchos lugares, seg\u00fan el contexto:</p> Nivel Ubicaci\u00f3n Ejemplo o archivo Comentario Inventario Archivo <code>inventory</code> o <code>group_vars/</code> / <code>host_vars/</code> Define variables por host o grupo Ideal para informaci\u00f3n de infraestructura Playbook Dentro de <code>vars:</code> o <code>vars_files:</code> <code>vars: { pkg_name: nginx }</code> Variables locales al playbook Rol En <code>defaults/</code> o <code>vars/</code> del rol <code>roles/webserver/defaults/main.yml</code> Prioridad distinta seg\u00fan carpeta Variables de entorno Exportadas desde el sistema <code>export ANSIBLE_VAR=value</code> Se usan con <code>lookup('env', 'VAR')</code> L\u00ednea de comandos Usando <code>-e</code> o <code>--extra-vars</code> <code>ansible-playbook play.yml -e \"pkg_name=nginx\"</code> M\u00e1xima prioridad Facts del sistema Recogidos autom\u00e1ticamente con <code>gather_facts</code> <code>ansible_hostname</code>, <code>ansible_distribution</code> Variables especiales del sistema remoto <p>Abstract</p> <p>Link a la documentaci\u00f3n oficial</p>"},{"location":"vars/#ejemplo-practico-variables-por-niveles","title":"Ejemplo Pr\u00e1ctico \u2014 Variables por Niveles","text":"<p>Supongamos que tenemos este inventario:</p> <pre><code>[webservers]\nweb1 ansible_host=192.168.1.10\nweb2 ansible_host=192.168.1.11\n[webservers:vars]\napp_port=80\n</code></pre> <p>Y este playbook <code>vars_demo.yml</code>:</p> <pre><code>---\n- name: Demostraci\u00f3n de variables\n  hosts: webservers\n  gather_facts: false\n\n  vars:\n    app_port: 8080\n\n  tasks:\n    - name: Mostrar el valor de app_port\n      ansible.builtin.debug:\n        msg: \"El puerto definido es {{ app_port }}\"\n</code></pre> <p>Ejecuta el playbook:</p> <pre><code>ansible-playbook -i inventory vars_demo.yml\n</code></pre> <p>Salida esperada:</p> <pre><code>TASK [Mostrar el valor de app_port] ********************************************\nok: [web1] =&gt; {\n    \"msg\": \"El puerto definido es 8080\"\n}\n</code></pre> <p>\ud83d\udc49 Aunque en el inventory definimos <code>app_port=80</code>, el valor dentro del playbook (<code>vars</code>) tiene prioridad y sobreescribe el del inventario.</p>"},{"location":"vars/#prioridad-de-variables-de-menor-a-mayor","title":"\ud83e\uddee Prioridad de Variables (de menor a mayor)","text":"<p>La precedencia determina cu\u00e1l valor \u201cgana\u201d cuando una variable se define en varios lugares. </p> <p>Un n\u00famero m\u00e1s alto en la prioridad sobreescribe al resto</p> Prioridad Nivel Ejemplo 1 <code>defaults/</code> dentro de un rol Valores por defecto, seguros pero sobrescribibles 2 Variables del inventario (<code>group_vars</code>, <code>host_vars</code>) Valores espec\u00edficos de infraestructura 3 Variables definidas en el playbook (<code>vars:</code> o <code>vars_files:</code>) Definiciones locales 4 Variables de registro (<code>set_fact</code>) Variables din\u00e1micas dentro de tareas 5 Variables de entorno (<code>lookup('env')</code>) Valores del entorno del sistema 6 Variables pasadas por l\u00ednea de comandos (<code>-e</code>) Tienen m\u00e1xima prioridad <p>Note</p> <p>Cuando dos variables con el mismo nombre existen en distintos niveles, Ansible usa la de mayor prioridad, ignorando el resto.</p>"},{"location":"vars/#ejemplo-sobrescritura-de-variables","title":"Ejemplo \u2014 Sobrescritura de Variables","text":"<p>Creamos el archivo <code>inventory</code>:</p> <pre><code>[all]\nlocalhost app_name=nginx\n</code></pre> <p>Y el playbook <code>vars_priority.yml</code>:</p> <pre><code>---\n- name: Prioridades de variables\n  hosts: localhost\n  connection: local\n  vars:\n    app_name: apache2\n  tasks:\n    - name: Mostrar variable definida\n      ansible.builtin.debug:\n        msg: \"Aplicaci\u00f3n: {{ app_name }}\"\n</code></pre>"},{"location":"vars/#valor-desde-el-playbook","title":"Valor desde el playbook:","text":"<pre><code>ansible-playbook vars_priority.yml\n</code></pre> <p>Salida:</p> <pre><code>\"msg\": \"Aplicaci\u00f3n: apache2\"\n</code></pre>"},{"location":"vars/#sobrescribir-desde-la-linea-de-comandos","title":"Sobrescribir desde la l\u00ednea de comandos:","text":"<pre><code>ansible-playbook vars_priority.yml -e \"app_name=nginx\"\n</code></pre> <p>Salida:</p> <pre><code>\"msg\": \"Aplicaci\u00f3n: nginx\"\n</code></pre> <p>Las variables pasadas con <code>-e</code> tienen m\u00e1xima prioridad.</p>"},{"location":"vars/#variables-de-entorno","title":"\u2699\ufe0f Variables de Entorno","text":"<p>Puedes acceder a variables del sistema con el lookup plugin:</p> <pre><code>- name: Mostrar usuario actual\n  ansible.builtin.debug:\n    msg: \"Usuario: {{ lookup('env','USER') }}\"\n</code></pre> <p>Ejemplo de uso pr\u00e1ctico en una ruta din\u00e1mica:</p> <pre><code>- name: Copiar archivo al home del usuario\n  ansible.builtin.copy:\n    src: test.txt\n    dest: \"{{ lookup('env','HOME') }}/test.txt\"\n</code></pre>"},{"location":"vars/#variables-dinamicas-y-facts","title":"\ud83d\udca1 Variables Din\u00e1micas y Facts","text":"<p>Ansible puede recopilar autom\u00e1ticamente informaci\u00f3n del sistema remoto (facts) si <code>gather_facts: true</code>.</p> <p>Ejemplo:</p> <pre><code>- name: Mostrar informaci\u00f3n del host\n  hosts: localhost\n  gather_facts: true\n  tasks:\n    - debug:\n        msg: \"Sistema operativo: {{ ansible_distribution }} {{ ansible_distribution_version }}\"\n</code></pre> <p>Tambi\u00e9n puedes definir variables din\u00e1micas durante la ejecuci\u00f3n con <code>set_fact</code>:</p> <pre><code>- name: Calcular ruta temporal\n  set_fact:\n    tmp_file: \"/tmp/{{ ansible_hostname }}_{{ ansible_date_time.hour }}.log\"\n</code></pre>"},{"location":"vars/#errores-comunes-y-buenas-practicas","title":"\ud83d\udea8 Errores Comunes y Buenas Pr\u00e1cticas","text":""},{"location":"vars/#errores-comunes","title":"Errores Comunes","text":"<ol> <li> <p>Variables no definidas</p> <pre><code>ERROR! 'pkg_name' is undefined\nThe task includes an option with an undefined variable.\nThe error was: 'pkg_name' is undefined\n</code></pre> <p>\u2192 Usa <code>default()</code> en tus expresiones: <code>{{ pkg_name | default('nginx',true) }}</code></p> <p>\u2192 A\u00f1adir la <code>true</code> hace que se asigne el valor default ante cadenas vac\u00edas</p> </li> <li> <p>Indentaci\u00f3n incorrecta</p> <p>\u2192 Afecta especialmente en bloques <code>vars:</code> y <code>vars_files:</code>.</p> </li> </ol>"},{"location":"vars/#buenas-practicas","title":"Buenas Pr\u00e1cticas","text":"<p>Tip</p> <ul> <li>Define variables al nivel m\u00e1s bajo posible (local antes que global).</li> <li>Usa <code>defaults/main.yml</code> en roles para asegurar valores seguros.</li> <li>Evita nombres gen\u00e9ricos (<code>port</code>, <code>user</code>); usa prefijos (<code>web_port</code>, <code>db_user</code>).</li> <li>Documenta el prop\u00f3sito de las variables.</li> </ul>"},{"location":"vars/#ejercicio-practico","title":"\ud83d\udcda Ejercicio Pr\u00e1ctico","text":"<p>Para iniciar el ejercicio, ejecuta: <pre><code>lab start vars\n</code></pre></p> <p>Crea un playbook llamado <code>vars_lab.yml</code> que:</p> <ol> <li>Se ejecute sobre <code>localhost</code></li> <li> <p>Defina las variables:</p> <p><pre><code>web_port: 8080\nweb_root: /tmp/demo\n</code></pre> 3. Crea el directorio <code>{{ web_root }}</code> y dentro de este un archivo <code>index.html</code> con el contenido:</p> <p><pre><code>Servidor escuchando en el puerto {{ web_port }}\n</code></pre> 4. Prueba sobrescribir <code>web_port</code> desde la l\u00ednea de comandos con <code>-e</code>.</p> </li> </ol> <p>Para evaluar el ejercicio, ejecuta: <pre><code>lab grade vars\n</code></pre></p> <p>Abstract</p> <ul> <li>M\u00f3dulo debug</li> <li>M\u00f3dulo copy</li> </ul> <p>\ud83d\udd2c Desaf\u00edo adicional:</p> <ul> <li>Agrega una tarea que muestre con <code>debug:</code> la ruta completa del archivo creado</li> <li>Agrega una tarea que muestre con <code>debug:</code> el contenido del archivo creado (se puede hacer en varios pasos)</li> </ul> <p>Abstract</p> <ul> <li>M\u00f3dulo slurp</li> </ul>"}]}